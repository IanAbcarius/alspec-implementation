from api.client import InferenceClient
import time

class TimingCommands:
    def __init__(self, client: InferenceClient):
        self.client = client
    
    def benchmark(self, model_name: str, input_text: str, iterations: int = 5):
        """
        Run multiple inferences to benchmark performance
        """
        print(f"BENCHMARK: Running {iterations} iterations with model: {model_name}")
        print(f"  Input: {input_text}")
        print("-" * 50)
        
        times = []
        
        for i in range(iterations):
            print(f"Run {i+1}/{iterations}: ", end="", flush=True)
            start_time = time.time()
            
            try:
                result = self.client.run_inference(
                    model_name=model_name,
                    input=input_text
                )
                end_time = time.time()
                inference_time = end_time - start_time
                times.append(inference_time)
                
                print(f"{inference_time:.3f}s - SUCCESS")
                
            except Exception as e:
                end_time = time.time()
                inference_time = end_time - start_time
                print(f"{inference_time:.3f}s - ERROR: {e}")
        
        if times:
            print("-" * 50)
            print("BENCHMARK RESULTS:")
            print(f"  Fastest: {min(times):.3f}s")
            print(f"  Slowest: {max(times):.3f}s")
            print(f"  Average: {sum(times)/len(times):.3f}s")
            print(f"  Total time: {sum(times):.3f}s")
        else:
            print("No successful runs to benchmark.")